<!--

Copyright (c) 2024 Marcos de Oliveira Capristo
Todos os direitos reservados.

MYREPORT é um projeto independente.
Oferece um ambiente para edição de laudos periciais,
voltado especialmente para Peritos Criminais Oficiais do Estado de São Paulo.
Idealizado e inicialmente desenvolvido pelo Perito Criminal Marcos de Oliveira Capristo.
Contato: marcos.moc@policiacientifica.sp.gov.br | (19) 9 8231-2774

-->

<!--

FRAGMENTO DE FORMULÁRIO - TOP

-->



<div class="alert alert-warning">                   
    {{ msg_about_this_form_to_user | safe }}
</div>

<!-- DADOS GERAIS DO FORMULÁRIO / ANÁLOGOS A CLASS ABSTRACT DO MODELS, MENOS PARA OS CHECKS DAS SUBSTÂNCIAS EXAMINADAS -->
<div class="item-group form-group border p-3 mb-3">

    <!-- Primeira Linha -->
    <div class="form-group row">
        <div class="form-group col-3">
            <label for="laudo">Laudo</label>
            <input type="text" id="laudo" name="laudo" class="form-control" title="teste ...." required value="{{ report.report_number }}">
        </div>
        <div class="form-group col-3">
            <label for="protocolo">Registro de Entrada.</label>
            <input type="text" id="protocolo" name="protocolo" class="form-control" required value="{{ protocol_prefix }}">
        </div>
        <div class="form-group col-6">
            <label for="fotografo">Fotógrafo</label>
            <input type="text" id="fotografo" name="fotografo" class="form-control" required value="{{ fotografo_prefix }}">
        </div>        
    </div>

    <!-- Segunda Linha -->
    <div class="form-group row">
        <div class="form-group col-4">
            <label for="boletim">Boletim</label>
            <input type="text" id="boletim" name="boletim" class="form-control" required>
        </div>
        <div class="form-group col-4">
            <label for="delegacia">Delegacia</label>
            <input type="text" id="delegacia" name="delegacia" class="form-control" required value="{{ delegacia }}">
        </div>
        <div class="form-group col-4">
            <label for="autoridade_requisitante">Autoridade Requisitante</label>
            <input type="text" id="autoridade_requisitante" name="autoridade_requisitante" class="form-control" required>
        </div>
    </div>
    <div class="form-group row">
        <div class="form-group col-6">
            <label for="objetivo">Objetivo (conforme Requsição)</label>
            <input type="text" id="objetivo" name="objetivo" class="form-control" required>
        </div>
        <div class="form-group col-6">
            <label for="naturesa">Naturesa (conforme Requsição)</label>
            <input type="text" id="naturesa" name="naturesa" class="form-control" required>
        </div>
    </div>


    <!-- Terceira Linha -->
    <div class="form-group d-flex justify-content-between">
        <div class="form-group">
            <label for="data_designacao">Designação</label>
            <input type="date" id="data_designacao" name="data_designacao" class="form-control" value="{{ before_date|date:'Y-m-d' }}" required>
        </div>
        <div class="form-group">
            <label for="data_acionamento">Acionamento</label>
            <input type="date" id="data_acionamento" name="data_acionamento" class="form-control" value="{{ before_date|date:'Y-m-d' }}" required>
        </div>
        <div class="form-group">
            <label for="hora_acionamento">Hora do acionamento</label>
            <input type="time" id="hora_acionamento" name="hora_acionamento" class="form-control" value="{{ before_time }}" required>
        </div>
        <div class="form-group">
            <label for="data_atendimento">Atendimento</label>
            <input type="date" id="data_atendimento" name="data_atendimento" class="form-control" value="{{ today_date|date:'Y-m-d' }}" required>
        </div>
        <div class="form-group">
            <label for="hora_atendimento">Hora do Atendimento</label>
            <input type="time" id="hora_atendimento" name="hora_atendimento" class="form-control" value="{{ current_time }}" required>
        </div>
    </div>
</div>


<script>

    //Atributos
    const reportNumber = document.querySelector('#laudo');
    const protocolNumber = document.querySelector('#protocolo');
    const photographer = document.querySelector('#fotografo');
    const policeReportNumber = document.querySelector('#boletim');
    const policeStation = document.querySelector('#delegacia');
    const requestingAuthority = document.querySelector('#autoridade_requisitante');
    const objectivit = document.querySelector('#objetivo');
    const crimeNature = document.querySelector('#naturesa');
    const desigatedDate = document.querySelector('#data_designacao');
    const activationDate = document.querySelector('#data_acionamento');
    const serviceTime = document.querySelector('#hora_acionamento');
    const releaseDate = document.querySelector('#data_atendimento');
    const releaseTime = document.querySelector('#hora_atendimento');
    const submitButton = document.querySelector('#enviar');

    //  Metodos
    desigatedDate.addEventListener('change', function(){
        activationDate.value = desigatedDate.value;
        releaseDate.value = desigatedDate.value;
        serviceTime.focus();
    });

    const testando = true;

    function testandoInputs(){
        if (testando){
            //reportNumber.value = 'L001';
            protocolNumber.value = 'P001';
            photographer.value = 'Fotógrafo Técnico Pericial';
            policeReportNumber.value = 'LP001';
            policeStation.value = 'Del. Sec. Limeira Plantão';
            requestingAuthority.value = 'Dra. Mariana Ferreira';
            objectivit.value = 'Objetivo';
            crimeNature.value = 'Naturesa';
            const today = new Date().toISOString().split('T')[0];
            desigatedDate.value = today;
            activationDate.value = today;
            releaseDate.value = today;
            serviceTime.value = '11:30';
            releaseTime.value = '12:30';
        }
    }

    function checkForm(){
        if (reportNumber.value.trim() == ''){
            alert('Valor do número do Laudo não pode estar vazio.');
            reportNumber.value = '';
            reportNumber.focus();
            return false;
        }

        if (protocolNumber.value.trim() == ''){
            alert('O valor do Registro de Entrada não pode ser vazio.');
            protocolNumber.value = '';
            protocolNumber.focus();
            return false;
        }

        if (photographer.value.trim() == ''){
            alert('Digite o nome do fotógrafo.');
            photographer.value = '';
            photographer.focus();
            return false;
        }

        if (policeReportNumber.value.trim() == ''){
            alert('Valor para boletim não pode ser vazio.');
            policeReportNumber.value = '';
            policeReportNumber.focus();
            return false;
        }

        if (policeStation.value.trim() == ''){
            alert('Valor para delegacia não pode ser vazio.');
            policeStation.value = '';
            policeStation.focus();
            return false;
        }

        if (requestingAuthority.value.trim() == ''){
            alert('Valor para Autoridade Requisitante não pode ser vazio.');
            requestingAuthority.value = '';
            requestingAuthority.focus();
            return false;
        }

        if (objectivit.value.trim() == ''){
            alert('Valor para Objetivo não pode ser vazio.');
            objectivit.value='';
            objectivit.focus();
            return false;
        }

        if (crimeNature.value.trim() == ''){
            alert('Valor para Naturesa não pode ser vazio.');
            crimeNature.value='';
            crimeNature.focus();
            return false;
        }

        if (!isValidDate(desigatedDate.value)){
            alert('Data inválida.');
            desigatedDate.focus();
            return false;
        }

        if (!isValidDate(activationDate.value)){
            alert('Data inválida.');
            activationDate.focus();
            return false;
        }

        if (!isValidTime(serviceTime.value)){
            alert('Hora inválida.');
            serviceTime.focus();
            return false;
        }

        if (!isValidDate(releaseDate.value)){
            alert('Data inválida.');
            releaseDate.focus();
            return false;
        }

        if (!isValidTime(releaseTime.value)){
            alert('Hora inválida.');
            releaseTime.focus();
            return false;
        }


        if (!beforeThan(activationDate.value, serviceTime.value, releaseDate.value, releaseTime.value)){
            alert('Data e hora do acionamento não pode ser superior a data e a hora do atendimento.');
            activationDate.focus();
            return false;
        }

        return true;

    }


    document.addEventListener('DOMContentLoaded', function() {

        reportNumber.addEventListener('change', function(){
            reportNumber.value = reportNumber.value.toUpperCase();
        });

        protocolNumber.addEventListener('change', function(){
            protocolNumber.value = protocolNumber.value.toUpperCase();
        });

        photographer.addEventListener('change', function(){
            photographer.value = toNiceName(photographer.value);
        });

        policeReportNumber.addEventListener('change', function(){
            policeReportNumber.value = policeReportNumber.value.toUpperCase();
        });

        policeStation.addEventListener('change', function(){
            policeStation.value = toNiceName(policeStation.value);
        });

        requestingAuthority.addEventListener('change', function(){
            requestingAuthority.value = toNiceName(requestingAuthority.value);
        });

        
        reportNumber.focus();

        //testandoInputs(); edit_report

    });    

</script>
